<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Livros</title>
  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <h2>Cadastro de Livros</h2>
  <form id="formLivro">
    <input type="text" id="titulo" placeholder="Título" required><br/>
    <input type="text" id="autor" placeholder="Autor" required><br/>
    <input type="number" id="ano" placeholder="Ano" required><br/>
   <button type="submit">Cadastrar Livro</button>
  </form>

  <h3>Livros Cadastrados</h3>
  <ul id="listaLivros"></ul>

  <script>
    // Cadastrar livro
    async function cadastrarLivro(event) {
      event.preventDefault();

      const livro = {
        titulo: document.getElementById('titulo').value,
        autor: document.getElementById('autor').value,
        ano: document.getElementById('ano').value,
      };

      const response = await fetch('http://localhost:3000/livros', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(livro),
      });

      const data = await response.json();
      console.log('Livro cadastrado:', data);
      //Atualiza lista de Livros
      atualizarListaDeLivros();
    }

    // Função ára exibir a lista de livros
    async function atualizarListaDeLivros() {
      const response = await fetch('http://localhost:3000/livros');
      const livros = await response.json();
      const listaLivros = document.getElementById('listaLivros');

      listaLivros.innerHTML=''; // Limpar a lista antes de atualiza-la

      livros.forEach((livro) => {
        const div = document.createElement('div');
        div.className='livro-item';
        div.innerHTML = `
          <strong>${livro.titulo}</strong> - ${livro.autor} (${livro.ano})
          <button class="btn btn-editar"onclick="editarLivro(${livro.id})">Alterar</button>
          <button class="btn btn-excluir"onclick="excluirLivro(${livro.id})">Excluir</button>
        `;
        listaLivros.appendChild(div);
      });
    }

    // Editar livro
    async function editarLivro(id) {
      const novoTitulo = prompt("Novo título:");
      const novoAutor = prompt("Novo autor:");
      const novoAno = prompt("Novo ano:");

      if (novoTitulo && novoAutor && novoAno) {
        const livroAtualizado = {
          titulo: novoTitulo,
          autor: novoAutor,
          ano: parseInt(novoAno),
        };

        await fetch(`http://localhost:3000/livros/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(livroAtualizado),
        });

        atualizarListaDeLivros();
      }
    }

    // Excluir livro
    async function excluirLivro(id) {
        if(confirm('Tem certeza que deseja excluir este livro?')){
        await fetch(`http://localhost:3000/livros/${id}`, {
        method: 'DELETE', 
        });

      atualizarListaDeLivros();
    }
}


// Vincular o evento de submit do formulario a função
    document.getElementById('formLivro').addEventListener('submit', cadastrarLivro);

    //Carregar a lista de livros ao carregar a pagina
    window.onload = atualizarListaDeLivros;
  </script>
</body>
</html>
