<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Discos de Vinil e CDs</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h2>Cadastro de Discos e CDs</h2>

      <form id="formDisco">
        <input type="hidden" id="discoId" />
        <input type="text" id="titulo" placeholder="T√≠tulo" required /><br />
        <input type="text" id="artista" placeholder="Artista" required /><br />
        <input type="number" id="ano" placeholder="Ano" required /><br />
        <input type="text" id="genero" placeholder="G√™nero" required /><br />

        <select id="formato" required>
          <option value="" disabled selected>Selecione o Formato</option>
          <option value="Vinil">Vinil</option>
          <option value="CD">CD</option></select
        ><br />

        <input
          type="number"
          id="preco"
          placeholder="Pre√ßo (R$)"
          step="0.01"
          required
        /><br />

        <button type="submit" id="btnSalvar">Cadastrar Disco</button>
        <button type="button" id="btnLimpar" style="display: none">
          Limpar/Cancelar Edi√ß√£o
        </button>
      </form>

      <h3>Cole√ß√£o Cadastrada</h3>
      <div id="listaDiscos"></div>
    </div>

    <script>
      const API_URL = "http://localhost:3000/discos";
      const formDisco = document.getElementById("formDisco");
      const btnSalvar = document.getElementById("btnSalvar");
      const btnLimpar = document.getElementById("btnLimpar");

      // Fun√ß√£o para preencher o formul√°rio no modo de Edi√ß√£o
      async function carregarParaEdicao(id) {
        const response = await fetch(`${API_URL}/${id}`);
        if (response.ok) {
          const disco = await response.json();

          // Preenche os campos
          document.getElementById("discoId").value = disco._id;
          document.getElementById("titulo").value = disco.titulo;
          document.getElementById("artista").value = disco.artista;
          document.getElementById("ano").value = disco.ano;
          document.getElementById("genero").value = disco.genero;
          document.getElementById("formato").value = disco.formato;
          document.getElementById("preco").value = disco.preco;

          // Atualiza o bot√£o para indicar Edi√ß√£o
          btnSalvar.textContent = "Salvar Altera√ß√µes";
          btnLimpar.style.display = "inline-block";
        }
      }

      // Fun√ß√£o principal de CRUD (Cadastro e Edi√ß√£o)
      async function salvarOuAtualizarDisco(event) {
        event.preventDefault();

        const id = document.getElementById("discoId").value;
        const discoData = {
          titulo: document.getElementById("titulo").value,
          artista: document.getElementById("artista").value,
          ano: parseInt(document.getElementById("ano").value),
          genero: document.getElementById("genero").value,
          formato: document.getElementById("formato").value,
          preco: parseFloat(document.getElementById("preco").value),
        };

        let method = "POST";
        let url = API_URL;

        if (id) {
          // Modo de Edi√ß√£o
          method = "PUT";
          url = `${API_URL}/${id}`;
        }

        const response = await fetch(url, {
          method: method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(discoData),
        });

        if (response.ok) {
          // Limpa e Atualiza a lista ap√≥s sucesso
          limparFormulario();
          atualizarListaDeDiscos();
        } else {
          console.error("Erro ao salvar disco:", await response.json());
          alert("Ocorreu um erro ao salvar o disco.");
        }
      }

      // Fun√ß√£o para listar todos os discos
      async function atualizarListaDeDiscos() {
        const response = await fetch(API_URL);
        const discos = await response.json();
        const listaDiscosDiv = document.getElementById("listaDiscos");

        listaDiscosDiv.innerHTML = ""; // Limpar antes de popular

        discos.forEach((disco) => {
          const div = document.createElement("div");
          div.className = "disco-item";
          div.innerHTML = `
    <p><strong>üíø T√≠tulo</strong> ${disco.titulo}</p><br>
    <p><strong>üíΩ Formato</strong> ${disco.formato}</p><br>
    <p><strong>üë©‚Äçüé§ Artista</strong> ${disco.artista}</p><br>
    <p><strong>üóìÔ∏è Ano</strong> ${disco.ano} </p><br>
    <p><strong>üé§ G√™nero</strong> ${disco.genero}</p><br>
    <p><strong>üíµ Pre√ßo</strong> R$ ${disco.preco.toFixed(2)}</p><br>
    <div class="actions">
        <button class="btn btn-editar" onclick="carregarParaEdicao('${
          disco._id
        }')">Editar</button>
        <button class="btn btn-excluir" onclick="excluirDisco('${
          disco._id
        }')">Excluir</button>
    </div>
                `;
          listaDiscosDiv.appendChild(div);
        });
      }

      // Fun√ß√£o para excluir um disco
      async function excluirDisco(id) {
        if (!confirm("Tem certeza que deseja excluir este disco?")) {
          // Confirma√ß√£o antes da remo√ß√£o 
          return;
        }
        const response = await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
        });

        if (response.status === 204) {
          atualizarListaDeDiscos();
        } else {
          alert("Erro ao excluir disco.");
        }
      }

      // Fun√ß√£o para limpar o formul√°rio e reverter para o modo de cadastro
      function limparFormulario() {
        formDisco.reset();
        document.getElementById("discoId").value = "";
        btnSalvar.textContent = "Cadastrar Disco";
        btnLimpar.style.display = "none";
      }

      // Vincula eventos
      formDisco.addEventListener("submit", salvarOuAtualizarDisco);
      btnLimpar.addEventListener("click", limparFormulario);

      // Carregar a lista de discos ao carregar a p√°gina
      window.onload = atualizarListaDeDiscos;
    </script>
  </body>
</html>
